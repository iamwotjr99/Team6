<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Unread Summary Test</title>
  <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
<h2>ğŸ“¨ Unread Summary í…ŒìŠ¤íŠ¸</h2>
<input type="text" id="userIdInput" placeholder="ìœ ì € ID ì…ë ¥" />
<button onclick="connectSummary()">êµ¬ë… ì‹œì‘</button>

<ul id="logs"></ul>

<script>
  let stompClient = null;

  function connectSummary() {
    const userId = document.getElementById('userIdInput').value;
    const socket = new SockJS(`http://localhost/ws-stomp?userId=${userId}`);
    stompClient = Stomp.over(socket);

    stompClient.connect({}, () => {
      console.log('ğŸ“¡ STOMP ì—°ê²° ì™„ë£Œ');

      stompClient.subscribe(`/sub/user/${userId}/unread-summary`, (message) => {
        const payload = JSON.parse(message.body);
        console.log(payload);
        const li = document.createElement('li');
        li.innerText = `[ì±„íŒ…ë°© ${payload.roomId}] ì•ˆì½ì€ ë©”ì‹œì§€: ${payload.unreadCount}`;
        document.getElementById('logs').appendChild(li);
      });
    });
  }
</script>
</body>
</html>
